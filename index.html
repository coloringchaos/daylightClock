<html>
   <head>
      <script type="text/javascript" src="/socket.io/socket.io.js"></script>
      <script type="text/javascript">

      var socket = io.connect('http://104.131.39.226:8080/');

      var sunriseUTC, sunsetUTC;
      var sunrise, sunset;

      var currentTime;
      var now;
      var daylength;

      var currentdegree;
                        
      socket.on('connect', function() {
         console.log("Connected");
         socket.emit('requestingJson');
      });

      var requestingJson = function() {   //function for requesting json - works with html 'get data' button
         socket.emit('requestingJson');
      };

      //RECEIVE JSON FROM SERVER
      socket.on('json', function(data){
         var json = JSON.parse(data);

         sunriseUTC = json.sys.sunrise;
         sunrise = convertUNIX(sunriseUTC);
         console.log("sunrise: " + sunrise);

         sunsetUTC = json.sys.sunset;
         sunset = convertUNIX(sunsetUTC);
         console.log("sunset: " + sunset);

         daylength = parseInt(sunset) - parseInt(sunrise);
         console.log("daylength:" + daylength);

         currentTime = getCurrentTime();
         now = parseInt(currentTime) - parseInt(sunrise);
         console.log('right now = ' + now);

         checkDayLight(); //this should call clock
         
      });

      var convertUNIX = function(UTC) {
         var date = new Date(UTC*1000);   // multiplied by 1000 so that the argument is in milliseconds to work with javascript
         
         var hours = date.getHours() * 60; 
         var minutes = "0" + date.getMinutes();
         var totalMinutes = parseInt(hours) + parseInt(minutes);

         var totalSeconds = parseInt(totalMinutes) * 60;

         return totalSeconds;
      }

      function getCurrentTime() {
         var date = new Date();
         var hours = date.getHours() * 60; 
         var minutes = "0" + date.getMinutes();
         var seconds = date.getSeconds();
         var totalMinutes = parseInt(hours) + parseInt(minutes);
         
         var totalSeconds = (parseInt(totalMinutes) * 60) + parseInt(seconds);

         return totalSeconds;
      }

      //check to see if it's currently within daylight hours
      //mostly for debugging...can delete later
      function checkDayLight() {
         if (currentTime > sunset || currentTime < sunrise) {
            console.log("IT'S DARK");
            return;
         } else {
            console.log("IT'S LIGHT OUT");
         }
      }


      setInterval(function() {
         //update now - this happens above also, maybe move to function to avoid redundancy?
         currentTime = getCurrentTime();
         now = parseInt(currentTime) - parseInt(sunrise);
         
         //update daylight - add this in case browser is open for a long time

         currentdegree = (360*now)/daylength; //in minutes, 1440 minutes in 24 hours

         if (currentdegree > 360){
            currentdegree = 0;
         }

         function rotate(el, degree) {
            el.setAttribute('transform', 'rotate('+ degree +' 50 50)')
         }
         
         rotate(hand, currentdegree);

         console.log('current degree: ' + currentdegree);

      }, 1000)
      

      </script>     

   </head>




   <body>
    
      <button type="button" onclick="requestingJson();">UPDATE</button>

      <div id="clock-div">

         <svg id="clock" viewBox="0 0 100 100">
         <circle id="face" cx="50" cy="50" r="45"/>
            <g id="hands">
               <line id="hand" x1="50" y1="50" x2="50" y2="4" />
            </g>
         </svg>

      </div>



   </body>

</html>




<style>
   #hand { 
      stroke: #FFFFFF; 
   }

   #clock-div {
      width:50%;
      height: 50%;
      padding-top:50px;
      margin-left: auto;
      margin-right: auto;
   }

</style>
